{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Clients%20era/CURRENT/v0-multi-vendor-e-commerce-website-main/v0-multi-vendor-e-commerce-website-main/app/api/auth/login/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { email, password } = await request.json()\r\n\r\n    // Validate input\r\n    if (!email || !password) {\r\n      return NextResponse.json({ error: \"Email and password are required\" }, { status: 400 })\r\n    }\r\n\r\n    const apiBaseUrl = process.env.NEXT_PUBLIC_API_URL || process.env.API_URL || \"http://localhost:8000\"\r\n\r\n    let apiResponse: Response\r\n    try {\r\n      apiResponse = await fetch(`${apiBaseUrl}/api/auth/login`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ email, password }),\r\n      })\r\n    } catch {\r\n      return NextResponse.json(\r\n        { error: `Backend unavailable. Start PHP API server at ${apiBaseUrl}` },\r\n        { status: 503 },\r\n      )\r\n    }\r\n\r\n    const rawBody = await apiResponse.text()\r\n    let data: any = null\r\n    try {\r\n      data = JSON.parse(rawBody)\r\n    } catch {\r\n      data = null\r\n    }\r\n\r\n    if (!data) {\r\n      return NextResponse.json(\r\n        {\r\n          error:\r\n            \"Backend returned a non-JSON response. This usually means the PHP API crashed or printed warnings (missing vendor/autoload.php, DB config, etc).\",\r\n          status: apiResponse.status,\r\n          responseSnippet: rawBody.slice(0, 300),\r\n        },\r\n        { status: 502 },\r\n      )\r\n    }\r\n\r\n    if (apiResponse.status === 404) {\r\n      return NextResponse.json(\r\n        {\r\n          error:\r\n            data?.error ||\r\n            `PHP backend route not found at ${apiBaseUrl}/api/auth/login. Verify XAMPP path + .htaccess rewrite.`,\r\n        },\r\n        { status: 503 },\r\n      )\r\n    }\r\n\r\n    if (!apiResponse.ok || !data?.success) {\r\n      return NextResponse.json({ error: data?.error || \"Login failed\" }, { status: apiResponse.status || 500 })\r\n    }\r\n\r\n    const token = data.token as string\r\n    const user = data.user as { email: string; role: string; full_name?: string; fullName?: string; store_name?: string; storeName?: string }\r\n\r\n    const response = NextResponse.json({\r\n      success: true,\r\n      user: {\r\n        email: user.email,\r\n        role: user.role,\r\n        fullName: user.full_name || user.fullName,\r\n        storeName: (user as any).store_name || (user as any).storeName,\r\n      },\r\n      message: data.message || \"Login successful\",\r\n    })\r\n\r\n    // Set authentication cookies\r\n    response.cookies.set(\"auth_token\", token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"lax\",\r\n      maxAge: 60 * 60 * 24 * 7, // 7 days\r\n      path: \"/\"\r\n    })\r\n\r\n    response.cookies.set(\"user_role\", user.role, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"lax\",\r\n      maxAge: 60 * 60 * 24 * 7,\r\n      path: \"/\"\r\n    })\r\n\r\n    response.cookies.set(\"user_email\", email, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"lax\",\r\n      maxAge: 60 * 60 * 24 * 7,\r\n      path: \"/\"\r\n    })\r\n\r\n    if (user.role !== \"admin\") {\r\n      response.cookies.set(\"admin_token\", \"\", {\r\n        httpOnly: false,\r\n        secure: process.env.NODE_ENV === \"production\",\r\n        sameSite: \"lax\",\r\n        maxAge: 0,\r\n        path: \"/\",\r\n      })\r\n\r\n      response.cookies.set(\"admin_email\", \"\", {\r\n        httpOnly: false,\r\n        secure: process.env.NODE_ENV === \"production\",\r\n        sameSite: \"lax\",\r\n        maxAge: 0,\r\n        path: \"/\",\r\n      })\r\n    }\r\n\r\n    return response\r\n\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Login failed\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}