{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Clients%20era/CURRENT/v0-multi-vendor-e-commerce-website-main/v0-multi-vendor-e-commerce-website-main/app/api/auth/admin-login/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email, password } = await request.json()\n\n    if (!email || !password) {\n      return NextResponse.json({ error: \"Email and password are required\" }, { status: 400 })\n    }\n\n    const apiBaseUrl = process.env.NEXT_PUBLIC_API_URL || process.env.API_URL || \"http://localhost:8000\"\n\n    let apiResponse: Response\n    try {\n      apiResponse = await fetch(`${apiBaseUrl}/api/auth/login`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, password }),\n      })\n    } catch {\n      return NextResponse.json(\n        { error: `Backend unavailable. Start PHP API server at ${apiBaseUrl}` },\n        { status: 503 },\n      )\n    }\n\n    const rawBody = await apiResponse.text()\n    let data: any = null\n    try {\n      data = JSON.parse(rawBody)\n    } catch {\n      data = null\n    }\n\n    if (!data) {\n      return NextResponse.json(\n        {\n          error:\n            \"Backend returned a non-JSON response. This usually means the PHP API crashed or printed warnings (missing vendor/autoload.php, DB config, etc).\",\n          status: apiResponse.status,\n          responseSnippet: rawBody.slice(0, 300),\n        },\n        { status: 502 },\n      )\n    }\n\n    if (apiResponse.status === 404) {\n      return NextResponse.json(\n        {\n          error:\n            data?.error ||\n            `PHP backend route not found at ${apiBaseUrl}/api/auth/login. Verify XAMPP path + .htaccess rewrite.`,\n        },\n        { status: 503 },\n      )\n    }\n\n    if (!apiResponse.ok || !data?.success) {\n      return NextResponse.json({ error: data?.error || \"Login failed\" }, { status: apiResponse.status || 500 })\n    }\n\n    if (data?.user?.role !== \"admin\") {\n      return NextResponse.json({ error: \"Admin access required\" }, { status: 403 })\n    }\n\n    const token = data.token as string\n\n    const response = NextResponse.json(\n      {\n        success: true,\n        token,\n        email,\n        message: data.message || \"Admin login successful\",\n      },\n      { status: 200 },\n    )\n\n    // Keep admin cookies readable by client-side admin-login page.\n    response.cookies.set(\"admin_token\", token, {\n      httpOnly: false,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      path: \"/\",\n      maxAge: 60 * 60 * 24,\n    })\n\n    response.cookies.set(\"admin_email\", email, {\n      httpOnly: false,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      path: \"/\",\n      maxAge: 60 * 60 * 24,\n    })\n\n    // Also set standard auth cookies so the rest of the app can treat admin like a normal role.\n    response.cookies.set(\"auth_token\", token, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24 * 7,\n      path: \"/\",\n    })\n\n    response.cookies.set(\"user_role\", \"admin\", {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24 * 7,\n      path: \"/\",\n    })\n\n    response.cookies.set(\"user_email\", email, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24 * 7,\n      path: \"/\",\n    })\n\n    return response\n  } catch (error) {\n    return NextResponse.json({ error: \"Login failed\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}