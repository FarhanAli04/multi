{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/Clients%20era/CURRENT/v0-multi-vendor-e-commerce-website-main/v0-multi-vendor-e-commerce-website-main/lib/socket-server.ts"],"sourcesContent":["import { Server as NetServer } from 'http'\r\nimport { NextApiRequest, NextApiResponse } from 'next'\r\nimport { Server as ServerIO } from 'socket.io'\r\n\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false,\r\n  },\r\n}\r\n\r\nlet io: ServerIO | null = null\r\nlet currentSettings: any = null\r\n\r\nconst fetchSettingsFromAPI = async () => {\r\n  try {\r\n    const response = await fetch(`${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/settings`)\r\n    const result = await response.json()\r\n    if (result.success && result.data) {\r\n      currentSettings = result.data\r\n      return result.data\r\n    }\r\n  } catch (error) {\r\n    console.error('Error fetching settings:', error)\r\n  }\r\n  return null\r\n}\r\n\r\nconst updateSettingsInAPI = async (settings: any) => {\r\n  try {\r\n    const response = await fetch(`${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/settings`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(settings)\r\n    })\r\n    const result = await response.json()\r\n    if (result.success) {\r\n      currentSettings = result.data\r\n      return result.data\r\n    }\r\n  } catch (error) {\r\n    console.error('Error updating settings:', error)\r\n  }\r\n  return null\r\n}\r\n\r\nconst SocketHandler = async (req: NextApiRequest, res: NextApiResponse & { socket: any }) => {\r\n  if (!io) {\r\n    console.log('Initializing Socket.IO server...')\r\n    const httpServer: NetServer = res.socket.server as any\r\n    io = new ServerIO(httpServer, {\r\n      path: '/api/socket',\r\n      addTrailingSlash: false,\r\n      cors: {\r\n        origin: \"*\",\r\n        methods: [\"GET\", \"POST\"]\r\n      }\r\n    })\r\n\r\n    // Load initial settings\r\n    await fetchSettingsFromAPI()\r\n\r\n    io.on('connection', (socket) => {\r\n      console.log('Client connected:', socket.id)\r\n\r\n      // Send current settings to new client\r\n      if (currentSettings) {\r\n        socket.emit('settings-update', currentSettings)\r\n      }\r\n\r\n      // Handle admin settings changes\r\n      socket.on('admin-settings-change', async (newSettings) => {\r\n        console.log('Admin settings change received:', newSettings)\r\n        \r\n        // Update in API\r\n        const updatedSettings = await updateSettingsInAPI(newSettings)\r\n        \r\n        if (updatedSettings) {\r\n          // Broadcast to all clients\r\n          io!.emit('settings-update', updatedSettings)\r\n          console.log('Settings broadcasted to all clients')\r\n        } else {\r\n          socket.emit('error', { message: 'Failed to update settings' })\r\n        }\r\n      })\r\n\r\n      socket.on('disconnect', () => {\r\n        console.log('Client disconnected:', socket.id)\r\n      })\r\n    })\r\n\r\n    res.socket.server.io = io\r\n    console.log('Socket.IO server initialized')\r\n  } else {\r\n    console.log('Socket.IO server already running')\r\n  }\r\n  \r\n  res.end()\r\n}\r\n\r\nexport default SocketHandler\r\n"],"names":[],"mappings":";;;;;;AAEA;;AAEO,MAAM,SAAS;IACpB,KAAK;QACH,YAAY;IACd;AACF;AAEA,IAAI,KAAsB;AAC1B,IAAI,kBAAuB;AAE3B,MAAM,uBAAuB;IAC3B,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,GAAG,CAAC,mBAAmB,IAAI,wBAAwB,aAAa,CAAC;QACzG,MAAM,SAAS,MAAM,SAAS,IAAI;QAClC,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;YACjC,kBAAkB,OAAO,IAAI;YAC7B,OAAO,OAAO,IAAI;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;IAC5C;IACA,OAAO;AACT;AAEA,MAAM,sBAAsB,OAAO;IACjC,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,GAAG,CAAC,mBAAmB,IAAI,wBAAwB,aAAa,CAAC,EAAE;YACzG,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QACA,MAAM,SAAS,MAAM,SAAS,IAAI;QAClC,IAAI,OAAO,OAAO,EAAE;YAClB,kBAAkB,OAAO,IAAI;YAC7B,OAAO,OAAO,IAAI;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;IAC5C;IACA,OAAO;AACT;AAEA,MAAM,gBAAgB,OAAO,KAAqB;IAChD,IAAI,CAAC,IAAI;QACP,QAAQ,GAAG,CAAC;QACZ,MAAM,aAAwB,IAAI,MAAM,CAAC,MAAM;QAC/C,KAAK,IAAI,oJAAQ,CAAC,YAAY;YAC5B,MAAM;YACN,kBAAkB;YAClB,MAAM;gBACJ,QAAQ;gBACR,SAAS;oBAAC;oBAAO;iBAAO;YAC1B;QACF;QAEA,wBAAwB;QACxB,MAAM;QAEN,GAAG,EAAE,CAAC,cAAc,CAAC;YACnB,QAAQ,GAAG,CAAC,qBAAqB,OAAO,EAAE;YAE1C,sCAAsC;YACtC,IAAI,iBAAiB;gBACnB,OAAO,IAAI,CAAC,mBAAmB;YACjC;YAEA,gCAAgC;YAChC,OAAO,EAAE,CAAC,yBAAyB,OAAO;gBACxC,QAAQ,GAAG,CAAC,mCAAmC;gBAE/C,gBAAgB;gBAChB,MAAM,kBAAkB,MAAM,oBAAoB;gBAElD,IAAI,iBAAiB;oBACnB,2BAA2B;oBAC3B,GAAI,IAAI,CAAC,mBAAmB;oBAC5B,QAAQ,GAAG,CAAC;gBACd,OAAO;oBACL,OAAO,IAAI,CAAC,SAAS;wBAAE,SAAS;oBAA4B;gBAC9D;YACF;YAEA,OAAO,EAAE,CAAC,cAAc;gBACtB,QAAQ,GAAG,CAAC,wBAAwB,OAAO,EAAE;YAC/C;QACF;QAEA,IAAI,MAAM,CAAC,MAAM,CAAC,EAAE,GAAG;QACvB,QAAQ,GAAG,CAAC;IACd,OAAO;QACL,QAAQ,GAAG,CAAC;IACd;IAEA,IAAI,GAAG;AACT;uCAEe"}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///D:/Clients%20era/CURRENT/v0-multi-vendor-e-commerce-website-main/v0-multi-vendor-e-commerce-website-main/app/api/socket/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server'\r\nimport SocketHandler from '@/lib/socket-server'\r\n\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false,\r\n  },\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  return SocketHandler(req as any, {\r\n    socket: { server: {} },\r\n    end: () => {},\r\n    json: (data: any) => data,\r\n    status: (code: number) => ({ json: (data: any) => data })\r\n  } as any)\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  return SocketHandler(req as any, {\r\n    socket: { server: {} },\r\n    end: () => {},\r\n    json: (data: any) => data,\r\n    status: (code: number) => ({ json: (data: any) => data })\r\n  } as any)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AACA;;AAEO,MAAM,SAAS;IACpB,KAAK;QACH,YAAY;IACd;AACF;AAEO,eAAe,IAAI,GAAgB;IACxC,OAAO,IAAA,oIAAa,EAAC,KAAY;QAC/B,QAAQ;YAAE,QAAQ,CAAC;QAAE;QACrB,KAAK,KAAO;QACZ,MAAM,CAAC,OAAc;QACrB,QAAQ,CAAC,OAAiB,CAAC;gBAAE,MAAM,CAAC,OAAc;YAAK,CAAC;IAC1D;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,OAAO,IAAA,oIAAa,EAAC,KAAY;QAC/B,QAAQ;YAAE,QAAQ,CAAC;QAAE;QACrB,KAAK,KAAO;QACZ,MAAM,CAAC,OAAc;QACrB,QAAQ,CAAC,OAAiB,CAAC;gBAAE,MAAM,CAAC,OAAc;YAAK,CAAC;IAC1D;AACF"}}]
}