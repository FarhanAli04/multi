{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\nfunction clearAdminCookies(res: NextResponse) {\n  res.cookies.set(\"admin_token\", \"\", {\n    httpOnly: false,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 0,\n  })\n  res.cookies.set(\"admin_email\", \"\", {\n    httpOnly: false,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 0,\n  })\n}\n\nexport async function middleware(request: NextRequest) {\n  const pathname = request.nextUrl.pathname\n  const isAdminPanelRoute = pathname.startsWith(\"/admin-panel\")\n  const isAdminLoginRoute = pathname === \"/auth/admin-login\"\n  const isAdminApiRoute = pathname.startsWith(\"/api/auth/admin\")\n  const isSellerRoute = pathname.startsWith(\"/seller\")\n  const isAuthRoute = pathname.startsWith(\"/auth/\")\n  const isCustomerRoute = pathname.startsWith(\"/customer\")\n  const wantedRole = request.nextUrl.searchParams.get(\"role\")\n\n  // Handle admin API routes\n  if (isAdminApiRoute) {\n    return NextResponse.next()\n  }\n\n  // Handle customer routes with cookie-based authentication\n  if (isCustomerRoute) {\n    const authToken = request.cookies.get(\"auth_token\")?.value\n    const userRole = request.cookies.get(\"user_role\")?.value\n    const adminToken = request.cookies.get(\"admin_token\")?.value\n\n    if (!authToken) {\n      const loginUrl = new URL(\"/auth/login?role=customer\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    if (userRole !== \"customer\") {\n      const loginUrl = new URL(\"/auth/login?role=customer\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    const res = NextResponse.next()\n    if (adminToken) {\n      clearAdminCookies(res)\n    }\n    return res\n  }\n\n  if (isAdminPanelRoute) {\n    const adminToken = request.cookies.get(\"admin_token\")?.value\n    const authToken = request.cookies.get(\"auth_token\")?.value\n    const userRole = request.cookies.get(\"user_role\")?.value\n\n    if (adminToken && userRole !== \"admin\") {\n      const loginUrl = new URL(\"/auth/admin-login\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    if (authToken && userRole !== \"admin\" && !adminToken) {\n      const loginUrl = new URL(\"/auth/admin-login\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    if (!adminToken && !(authToken && userRole === \"admin\")) {\n      const loginUrl = new URL(\"/auth/admin-login\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    // Token exists, allow access\n    return NextResponse.next()\n  }\n\n  // Handle seller routes with cookie-based authentication\n  if (isSellerRoute) {\n    const authToken = request.cookies.get(\"auth_token\")?.value\n    const userRole = request.cookies.get(\"user_role\")?.value\n    const adminToken = request.cookies.get(\"admin_token\")?.value\n\n    if (!authToken) {\n      const loginUrl = new URL(\"/auth/login?role=seller\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    if (userRole === \"admin\") {\n      return NextResponse.redirect(new URL(\"/admin-panel\", request.url))\n    }\n\n    if (userRole !== \"seller\") {\n      const loginUrl = new URL(\"/auth/login?role=seller\", request.url)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    const res = NextResponse.next()\n    if (adminToken) {\n      clearAdminCookies(res)\n    }\n    return res\n  }\n\n  // Redirect authenticated users away from auth pages\n  if (isAuthRoute) {\n    const authToken = request.cookies.get(\"auth_token\")?.value\n    const userRole = request.cookies.get(\"user_role\")?.value\n    const adminToken = request.cookies.get(\"admin_token\")?.value\n\n    if (pathname === \"/auth/register\") {\n      return NextResponse.next()\n    }\n\n    // Allow switching roles by explicitly visiting a role-specific login.\n    // Example: currently logged in as customer, but visiting /auth/login?role=seller should not redirect to '/'.\n    if (pathname === \"/auth/login\" && wantedRole && userRole && wantedRole !== userRole) {\n      return NextResponse.next()\n    }\n\n    if (isAdminLoginRoute && userRole && userRole !== \"admin\") {\n      return NextResponse.next()\n    }\n\n    if (adminToken && userRole === \"admin\") {\n      return NextResponse.redirect(new URL(\"/admin-panel\", request.url))\n    }\n\n    if (authToken) {\n      if (userRole === \"admin\") {\n        return NextResponse.redirect(new URL(\"/admin-panel\", request.url))\n      }\n      if (userRole === \"seller\") {\n        return NextResponse.redirect(new URL(\"/seller\", request.url))\n      }\n      if (userRole === \"customer\") {\n        return NextResponse.redirect(new URL(\"/customer\", request.url))\n      }\n    }\n\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\"/((?!_next/static|_next/image|favicon.ico|.*\\\\..*).*)\"],\n}\n"],"names":[],"mappings":"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"}}]
}